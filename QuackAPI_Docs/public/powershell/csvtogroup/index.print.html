<!DOCTYPE html>
<html lang="en-gb" dir="ltr">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.127.0">
    <meta name="generator" content="Relearn 5.23.2+tip">
    <meta name="description" content="Documentation for the QuackBot API &amp; Machys useful scripts">
    <meta name="author" content="MACHY Of MACH 2 Simulations">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="From CSV To AD Group :: Quack Bot API Docs">
    <meta name="twitter:description" content="This script will read from a CSV and add users with the email in it to an AD Group.
This is very useful when you need an non IT Person to be able to add users to a group, without them going within 100 miles of AD, or involving IT.
This needs to be run as an admin with AD Perms.
REQUIRES Machy&rsquo;s Functions Requires the DBW Function from this script.">
    <meta property="og:title" content="From CSV To AD Group :: Quack Bot API Docs">
    <meta property="og:description" content="This script will read from a CSV and add users with the email in it to an AD Group.
This is very useful when you need an non IT Person to be able to add users to a group, without them going within 100 miles of AD, or involving IT.
This needs to be run as an admin with AD Perms.
REQUIRES Machy&rsquo;s Functions Requires the DBW Function from this script.">
    <meta property="og:type" content="article">
    <meta property="og:url" content="http://localhost:1313/powershell/csvtogroup/index.html">
    <meta property="article:section" content="PowerShell :: Quack Bot API Docs">
    <meta property="og:site_name" content="Quack Bot API Docs">
    <title>From CSV To AD Group :: Quack Bot API Docs</title>
    <link href="http://localhost:1313/powershell/csvtogroup/index.html" rel="canonical" type="text/html" title="From CSV To AD Group :: Quack Bot API Docs">
    <link href="/powershell/csvtogroup/index.xml" rel="alternate" type="application/rss+xml" title="From CSV To AD Group :: Quack Bot API Docs">
    <link href="/images/favicon.png?1746567088" rel="icon" type="image/png">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="/css/fontawesome-all.min.css?1746567089" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/fontawesome-all.min.css?1746567089" rel="stylesheet"></noscript>
    <link href="/css/nucleus.css?1746567089" rel="stylesheet">
    <link href="/css/auto-complete.css?1746567089" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/auto-complete.css?1746567089" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar.min.css?1746567089" rel="stylesheet">
    <link href="/css/fonts.css?1746567089" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/fonts.css?1746567089" rel="stylesheet"></noscript>
    <link href="/css/theme.css?1746567089" rel="stylesheet">
    <link href="/css/theme-ZenRed.css?1746567089" rel="stylesheet" id="R-variant-style">
    <link href="/css/chroma-relearn-dark.css?1746567089" rel="stylesheet" id="R-variant-chroma-style">
    <link href="/css/variant.css?1746567089" rel="stylesheet">
    <link href="/css/print.css?1746567089" rel="stylesheet" media="print">
    <link href="/css/format-print.css?1746567089" rel="stylesheet">
    <link href="/css/ie.css?1746567089" rel="stylesheet">
    <script src="/js/url.js?1746567089"></script>
    <script src="/js/variant.js?1746567089"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="/index.search.js";
      var root_url="/";
      var baseUri=root_url.replace(/\/$/, '');
      window.relearn = window.relearn || {};
      window.relearn.baseUriFull='http:\/\/localhost:1313/';
      // variant stuff
      window.relearn.themeVariantModifier='';
      window.variants && variants.init( [ 'ZenRed', 'relearn-auto', 'relearn-light', 'relearn-dark', 'relearn-bright', 'zen-auto', 'zen-light', 'zen-dark', 'neon', 'learn', 'blue', 'green', 'red', 'ZenRed' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>
  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="/powershell/csvtogroup/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/powershell/index.html"><span itemprop="name">PowerShell</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">From CSV To AD Group</span><meta itemprop="position" content="2"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>
<h1 id="from-csv-to-ad-group">From CSV To AD Group</h1>

<p>This script will read from a CSV and add users with the email in it to an AD Group.</p>
<p>This is very useful when you need an non IT Person to be able to add users to a group, without them going within 100 miles of AD, or involving IT.</p>
<p><em><strong>This needs to be run as an admin with AD Perms.</strong></em></p>
<h2 id="requires-machys-functions">REQUIRES Machy&rsquo;s Functions</h2>
<p>Requires the DBW Function from this script. You can just add the function to the top of the file.<br>
<a href="/powershell/csvtogroup/../../mfunctions.md">Mach&rsquo;s Functions</a></p>
<h2 id="the-script-itself">The Script itself</h2>
<p><a href="/powershell/csvtogroup/../../PowerShell/Scripts/CSVtoAD.ps1">ProfileFix.ps1</a><br>
<a href="/powershell/csvtogroup/../../PowerShell/Scripts/CSVAD.csv">CSVAD.CSV</a></p>
<h3 id="usage">Usage</h3>
<p>Line 2 Update function file location, or replace with the DBW function from Mach&rsquo;s Functions.<br>
$LogRoot # Update to your preferred location for logging.<br>
$Debug # Set to true if you are having issues.<br>
$UserEmail #If you want the script to be able to take (UPNS) as well as just the username add the UPN here, if your user understand &ldquo;just the username&rdquo; then you don&rsquo;t need to change it.</p>
<h3 id="the-csv">The CSV</h3>
<p>Delete the first row AFTER The headers<br>
Put username in first column<br>
One per row</p>
<p><em><strong>CSV</strong></em>
&ldquo;EmailOrUsername&rdquo;,&ldquo;LastRun-dd-MM-yyyy-hh-mm&rdquo;
&ldquo;Delete_this_row&rdquo;,&ldquo;19_01_2024_10_12&rdquo;</p>
<h3 id="script">Script</h3>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>cls
</span></span><span style="display:flex;"><span>Import-Module <span style="color:#e6db74">&#34;C:\Scripts\Mach-Functions.psm1&#34;</span>
</span></span><span style="display:flex;"><span>$Date = Get-Date -Format dd_MM_yyyy_hh_mm
</span></span><span style="display:flex;"><span>$LogRoot = <span style="color:#e6db74">&#34;C:\Data&#34;</span>
</span></span><span style="display:flex;"><span>$Log = <span style="color:#e6db74">&#34;</span>$LogRoot<span style="color:#e6db74">\CSVADlog_</span>$Date<span style="color:#e6db74">.txt&#34;</span>
</span></span><span style="display:flex;"><span>Start-Transcript $log
</span></span><span style="display:flex;"><span>$Debug = $false <span style="color:#75715e"># Should we be verbose with printing info</span>
</span></span><span style="display:flex;"><span>$CSVAD = <span style="color:#e6db74">&#34;</span>$LogRoot<span style="color:#e6db74">\CSVAD.csv&#34;</span>
</span></span><span style="display:flex;"><span>$CSVADdone = <span style="color:#e6db74">&#34;</span>$LogRoot<span style="color:#e6db74">\CSVADDone.csv&#34;</span>
</span></span><span style="display:flex;"><span>$CSVADFailedToAdd = <span style="color:#e6db74">&#34;</span>$LogRoot<span style="color:#e6db74">\CSVADFailedToAdd.csv&#34;</span>
</span></span><span style="display:flex;"><span>$CSVADGroup = <span style="color:#e6db74">&#34;UserGroup&#34;</span>
</span></span><span style="display:flex;"><span>$UserEmail = <span style="color:#e6db74">&#34;`@EmailDomain.co.uk&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Write-Host <span style="color:#e6db74">&#34;List </span>$CSVAD<span style="color:#e6db74"> LogList </span>$CSVADdone<span style="color:#e6db74"> Failed List </span>$CSVADFailedToAdd<span style="color:#e6db74"> Group Name </span>$CSVADGroup<span style="color:#e6db74"> Debug </span>$Debug<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>$users = Import-CSV $CSVAD
</span></span><span style="display:flex;"><span>Write-Host <span style="color:#e6db74">&#34;List Of Users </span>$Users<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">foreach</span> ($User <span style="color:#66d9ef">in</span> $Users){
</span></span><span style="display:flex;"><span>    DBW ($User.EmailOrUsername <span style="color:#f92672">-eq</span> <span style="color:#e6db74">&#34;Delete_this_row&#34;</span>) <span style="color:#e6db74">&#34;blue&#34;</span> $false
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ($User.EmailOrUsername <span style="color:#f92672">-eq</span> <span style="color:#e6db74">&#34;Delete_this_row&#34;</span>) {
</span></span><span style="display:flex;"><span>        Write-Host <span style="color:#e6db74">&#34;No users to add / instructions ignored, goodbye (Closeing)&#34;</span> -ForegroundColor Red
</span></span><span style="display:flex;"><span>        Stop-Transcript
</span></span><span style="display:flex;"><span>        exit <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    $User = $User.EmailOrUsername <span style="color:#f92672">-replace</span> <span style="color:#e6db74">&#34;</span>$UserEmail<span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span> 
</span></span><span style="display:flex;"><span>    DBW <span style="color:#e6db74">&#34;Trying to add </span>$User<span style="color:#e6db74"> To </span>$CSVADGroup<span style="color:#e6db74"> &#34;</span> <span style="color:#e6db74">&#34;blue&#34;</span> $Debug
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        Write-Host <span style="color:#e6db74">&#34;Lets try to add the user&#34;</span>
</span></span><span style="display:flex;"><span>        Add-ADGroupMember -Identity $CSVADGroup -Members $User
</span></span><span style="display:flex;"><span>        $Name = Get-ADUser $User | Select -ExpandProperty Name
</span></span><span style="display:flex;"><span>        Write-Host <span style="color:#e6db74">&#34;Sucsess, lets add this to a file so i don&#39;t keep getting asked&#34;</span>
</span></span><span style="display:flex;"><span>        [<span style="color:#66d9ef">PSCustomObject] [ordered</span>] @{
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;EmailOrUsername&#39;</span> = $User
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;Name&#39;</span>            = $Name
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;DateAdded&#39;</span>       = get-date -Format dd_MM_yyyy_HH_mm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        } | Export-Csv -Path <span style="color:#e6db74">&#34;</span>$CSVADdone<span style="color:#e6db74">&#34;</span> -NoTypeInformation -Append
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">catch</span> {
</span></span><span style="display:flex;"><span>        DBW <span style="color:#e6db74">&#34;Failed to add </span>$User<span style="color:#e6db74">, lets log this&#34;</span> <span style="color:#e6db74">&#34;red&#34;</span> $Debug
</span></span><span style="display:flex;"><span>        [<span style="color:#66d9ef">PSCustomObject] [ordered</span>] @{
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;EmailOrUsername&#39;</span> = $User
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;DateFailed&#39;</span>       = get-date -Format dd_MM_yyyy_hh_mm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        } | Export-Csv -Path <span style="color:#e6db74">&#34;</span>$CSVADFailedToAdd<span style="color:#e6db74">&#34;</span> -NoTypeInformation -Append
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[<span style="color:#66d9ef">PSCustomObject] [ordered</span>] @{
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;EmailOrUsername&#39;</span> = <span style="color:#e6db74">&#34;Delete_this_row&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;LastRun-dd-MM-yyyy-hh-mm&#39;</span> = Get-Date -Format dd_MM_yyyy_hh_mm 
</span></span><span style="display:flex;"><span>} | Export-Csv -Path <span style="color:#e6db74">&#34;</span>$CSVAD<span style="color:#e6db74">&#34;</span> -NoTypeInformation
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Stop-Transcript</span></span></code></pre></div>
            <footer class="footline">
            </footer>
          </article>

        </div>
      </main>
    </div>
    <script src="/js/clipboard.min.js?1746567089" defer></script>
    <script src="/js/perfect-scrollbar.min.js?1746567089" defer></script>
    <script src="/js/theme.js?1746567089" defer></script>
  </body>
</html>
